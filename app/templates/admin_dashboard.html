{% extends "base.html" %}
{% block content %}
<section class="dashboard admin-dashboard">
    <aside class="dashboard-sidebar">
        <div class="user-card">
            <div class="user-avatar" aria-hidden="true">ğŸ‘¤</div>
            <div class="user-meta">
                <strong>{{ user.display_name or user.email }}</strong>
                <span>{{ user.email }}</span>
            </div>
        </div>
        <nav class="dashboard-menu" aria-label="ç®¡ç†å‘˜åŠŸèƒ½èœå•">
            <button class="menu-item is-active" type="button" data-target="admin-activation">æ¿€æ´»ç ç®¡ç†</button>
        </nav>
    </aside>

    <div class="dashboard-content">
        <section id="admin-activation" class="dashboard-panel is-active" data-section="activation">
            <div class="panel-header">
                <h3>æ¿€æ´»ç ç®¡ç†</h3>
            </div>

            <div class="admin-card">
                <h4>ç”Ÿæˆæ¿€æ´»ç </h4>
                <form method="post" action="/admin/codes" class="admin-form">
                    <div class="field-row">
                        <div class="field-input">
                            <label for="code-quantity">æ•°é‡</label>
                            <input id="code-quantity" type="number" name="quantity" value="1" min="1" max="100">
                        </div>
                        <div class="field-input">
                            <label for="code-expire">æœ‰æ•ˆæœŸï¼ˆå¤©ï¼Œå¯é€‰ï¼‰</label>
                            <input id="code-expire" type="number" name="expires_in_days" min="1" max="365" placeholder="ç•™ç©ºè¡¨ç¤ºé•¿æœŸæœ‰æ•ˆ">
                        </div>
                    </div>
                    <div class="field-row">
                        <div class="field-input">
                            <label for="code-notes">å¤‡æ³¨</label>
                            <input id="code-notes" type="text" name="notes" maxlength="255" placeholder="å¯é€‰è¯´æ˜">
                        </div>
                    </div>
                    <button type="submit">ç”Ÿæˆæ¿€æ´»ç </button>
                </form>
            </div>

            <div class="admin-card">
                <h4>æœ€æ–°æ¿€æ´»ç è®°å½•</h4>
                <div class="table-wrapper">
                    <table class="admin-table">
                        <thead>
                            <tr>
                                <th>æ¿€æ´»ç </th>
                                <th>çŠ¶æ€</th>
                                <th>æ‰¹æ¬¡</th>
                                <th>å¤‡æ³¨</th>
                                <th>è¿‡æœŸæ—¶é—´</th>
                                <th>ä½¿ç”¨äºº</th>
                                <th>ä½¿ç”¨æ—¶é—´</th>
                            </tr>
                        </thead>
                        <tbody>
                        {% for code in codes %}
                            <tr class="{{ 'used' if code.is_used else 'available' }}">
                                <td><code>{{ code.code }}</code></td>
                                <td>{{ 'å·²ä½¿ç”¨' if code.is_used else 'æœªä½¿ç”¨' }}</td>
                                <td>{{ code.batch or 'â€”' }}</td>
                                <td>{{ code.notes or 'â€”' }}</td>
                                <td>
                                    {% if code.expires_at %}
                                        {{ code.expires_at|display_time }}
                                    {% else %}
                                        æ°¸ä¸è¿‡æœŸ
                                    {% endif %}
                                </td>
                                <td>
                                    {% if code.used_by_user %}
                                        {{ code.used_by_user.display_name or code.used_by_user.email }}
                                    {% else %}â€”{% endif %}
                                </td>
                                <td>{% if code.used_at %}{{ code.used_at|display_time }}{% else %}â€”{% endif %}</td>
                            </tr>
                        {% else %}
                            <tr>
                                <td colspan="7">æš‚æ— æ¿€æ´»ç è®°å½•ã€‚</td>
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </section>
    </div>
</section>
{% endblock %}
