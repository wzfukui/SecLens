# SecLens 重构工作计划

> 最新更新：2025-03-09  
> 维护人：Codex（AI 代理）

## 目标综述
- **体验**：重建 SecLens UI 设计体系，统一交互语言，提升导航与可访问性。
- **内容**：强化情报内容模型（标签、主题、搜索、过滤），支持可配置的板块与查询。
- **插件平台**：建立插件生命周期管理、调度执行、结果回传与观测闭环。
- **基础设施**：完善数据库结构、测试体系与开发者文档，为持续迭代奠定基础。

---

## 阶段一：体系规划与基线搭建
1. **产品信息基线**
   - 梳理现有 API、页面、插件契约，补齐 README/AGENTS 中缺失的关键说明。
   - 输出 UI 设计原则、颜色/排版基线、响应式断点规范。
2. **工程准备**
   - 引入前端构建工具（Vite/ESBuild）与资产管线，将内联 CSS/JS 拆分成可维护的模块。
   - 重构模板结构（base 布局、局部组件、宏）。
3. **数据库审视/重构**
   - 重新定义 Bulletin 与 Plugin 相关表结构（支持标签多对多、插件版本历史、运行日志）。
   - 生成 Alembic 初始迁移（开发环境可直接 drop/create）。

**验收**：新的工程骨架跑通（`uvicorn` 正常启动、构建链路通过）、数据库迁移脚本可执行。

---

## 阶段二：UI / 内容体验
1. **设计系统落地**
   - 提取全局样式（色板、排版、Shadow、Spacing），构建 `styles/` 与 `components/` 目录。
   - 提供可复用的导航、按钮、标签、表格、卡片组件。
2. **首页体验重写**
   - 板块/来源导航改成配置驱动 + 状态显式展示。
   - 引入骨架屏/加载状态、错误提示、空状态组件。
   - 支持高级筛选、搜索（标题+摘要+标签+主题）与分页/无限滚动的可配置切换。
3. **内容模型增强**
   - 重写 `crud.list_bulletins`，使用 JSONB 索引 (PostgreSQL) 处理标签/主题。
   - 新增全文检索字段或接入 PostgreSQL `tsvector`。

**验收**：新首页和详情页上线（保持 API 兼容），搜索/过滤体验可用，`pytest -k home` 通过。

---

## 阶段三：插件平台 2.0
1. **插件模型与 API**
   - 新增 `plugin_versions`、`plugin_runs`、`plugin_events`，明确版本与实例分离。
   - 上传接口支持覆盖/升级，激活指定版本；提供停用/卸载/删除流程。
   - 插件契约：标准化 manifest（版本、权限、回调）、运行参数、回调协议，更新 `PLUGIN_SPEC.md`。
2. **调度与执行**
   - 替换线程调度器（选择 APScheduler/Celery + Redis），支持并发控制、运行超时、失败重试。
   - 运行结果：缓存输出、标准化日志、可视化最近执行记录。
3. **观测与运营**
   - 插件 Dashboard 重构：总览、版本历史、运行图表、失败告警。
   - 增加插件运行详情 API 和界面（日志、 payload、状态流转）。

**验收**：示例插件（aliyun/huawei）跑通新框架；Dashboard 展示正确；测试覆盖运行调度与 API。

---

## 阶段四：测试、自动化与文档
1. **测试体系**
   - 扩展 pytest 覆盖：UI 层快照/API 集成/调度任务。
   - 引入 Playwright 或 pytest-bdd 做关键交互测试。
2. **质量保障**
   - 配置 Ruff/Black/MyPy 统一风格。
   - 增加 pre-commit 钩子、CI Pipeline（lint + test + build）。
3. **文档 & 研发流程**
   - 更新 `README.md`（运行方式、构建流程、插件开发指南）。
   - 维护 `ROADMAP.md` 与 `AGENTS.md` 的范围说明，增加贡献指南。

**验收**：CI 绿灯、核心模块覆盖率 ≥ 80%、文档同步更新。

---

## 近期迭代里程碑（按顺序）
1. **Milestone A：工程骨架 + DB 重建**
2. **Milestone B：UI 设计系统 & 新首页**
3. **Milestone C：插件平台核心（模型 + 调度）**
4. **Milestone D：观测面板 + 运营工具**
5. **Milestone E：测试与文档收尾**

每个里程碑将以独立分支 / PR 管理，并同步更新本文件。

---

## 下一步动作（立即执行）
1. 调整 `AGENTS.md`，补充新的结构与工作方式。
2. 搭建前端构建脚手架，拆分现有模板资产。
3. 设计新的数据库 schema（`bulletins`, `plugins`, `plugin_versions`, `plugin_runs`) 并准备迁移脚本。
